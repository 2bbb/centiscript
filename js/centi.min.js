function evalInContext(source,context){function values(){var a=[];for(var b in context)context.hasOwnProperty(b)&&a.push(context[b]);return a}source="(function("+Object.keys(context).join(", ")+") {"+source+"})";var compiled=eval(source);return compiled.apply(context,values())}function get_url_vars(){for(var b,a=new Object,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)b=c[d].split("="),2==b.length&&(a[decodeURIComponent(b[0])]=decodeURIComponent(b[1]));return a}function checkFileReaderApi(){return window.File&&window.FileReader&&window.FileList&&window.Blob}function checkFileWriterApi(){return window.File&&window.saveAs&&window.FileList&&window.Blob}function getAudioContext(){return audioContext?audioContext:!audioContext&&audioContextClass?audioContext=new audioContextClass:null}function getAudioAnalyser(){return audioAnalyser||(audioAnalyser=getAudioContext().createAnalyser())}var MATH_PROPS=["E","LN2","LN10","LOG2E","LOG10E","PI","PI2","SQRT1_2","SQRT2"],MATHS=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","imul","log","max","min","pow","random","round","sin","sqrt","tan"],CTX_FUNCS=Object.getOwnPropertyNames(CanvasRenderingContext2D.prototype);PI2=Math.PI2=2*Math.PI;var Centi=function(a){this.ver="0.3.3",this.name=a?a:"ct",this.canvas=null,this.ctx=null,this.dsp={enable:!1,context:null,analyser:null,processor:null},this.sampleRate=44100,this.fft=new Uint8Array(1024),this.waveUint=new Uint8Array(2048),this.wave=new Float32Array(2048),this.GOLD=(1+Math.sqrt(5))/2,this.x=0,this.y=0,this.c=0,this.time=0,this.w=720,this.h=360,this.cx=this.w/2,this.cy=this.h/2,this.tempo={bpm:120,sec:.5,preSec:0,divide:4},this.beat=0,this.initSec=this.now(),this.bgcolor={r:0,g:0,b:0},this.bFill=!0,this.kdtree,this.setupMethod="",this.drawMethod="",this.beatMethod="",this.dspMethod="",this.drawFunc=null,this.beatFunc=null,this.dspFunc=null,this.toGifFunc=null,this.b3d=!1,this.pluginInstances=[]};Centi.plugins=[],Centi.prototype.destroy=function(){this.dsp.processor&&(this.dsp.processor.disconnect(),this.dsp.processor.onaudioprocess=null,this.dsp.processor=null),this.dsp.analyser&&(this.dsp.analyser.disconnect(),this.dsp.analyser=null),this.dsp.context&&this.dsp.context.distination.disconnect(),this.dsp.context=null,this.canvas=null,this.ctx=null,this.dsp=null,this.tempo=null,this.toGifFunc=null,this.drawFunc=null,this.beatFunc=null,this.dspFunc=null,this.fft=null,this.wave=null,this.b3d=!1,this.pluginInstances=null},Centi.prototype.init=function(a,b){if(this.canvas=a,this.initSec=this.now(),this.time=0,b){this.dsp.enable=!0,this.dsp.context=b,this.dsp.context.createScriptProcessor=this.dsp.context.createScriptProcessor||this.dsp.context.createJavaScriptNode;var c=function(){return/(Win(dows )?NT 6\.2)/.test(navigator.userAgent)?1024:/(Win(dows )?NT 6\.1)/.test(navigator.userAgent)?1024:/(Win(dows )?NT 6\.0)/.test(navigator.userAgent)?2048:/Win(dows )?(NT 5\.1|XP)/.test(navigator.userAgent)?4096:/Mac|PPC/.test(navigator.userAgent)?4096:/Linux/.test(navigator.userAgent)?8192:/iPhone|iPad|iPod/.test(navigator.userAgent)?2048:16384};this.dsp.analyser=this.dsp.context.createAnalyser(),this.dsp.analyser.connect(this.dsp.context.destination),this.sampleRate=this.dsp.context.sampleRate;var d=1/this.dsp.context.sampleRate,e=this.dsp.context.createScriptProcessor(c(),0,2);this.dsp.processor=e;var f=this.dsp.context.createBufferSource();f.connect(e),e.connect(this.dsp.analyser);var g=this;e.onaudioprocess=function(a){g.updateBeat();for(var b=a.outputBuffer.getChannelData(0),c=a.outputBuffer.getChannelData(1),e=0;e<this.bufferSize;e++){g.time;var h=g.doDsp();b[e]=h,c[e]=h,g.time+=d}}}else this.dsp.enable=!1;for(var h=0;h<Centi.plugins.length;h++){var i=new Centi.plugins[h](this);this.pluginInstances.push(i)}return a.getContext?!0:!1},Centi.prototype.doDsp=function(){return this.dspFunc?this.dspFunc():0},Centi.prototype.parse=function(a){function r(a,b){a=a.replace(l,b+"."+"$1"+"$2"),a=a.replace(k,"$2"),a=a.replace(f,"for("),a=a.replace(g,"while("),a=a.replace(h,"if("),a=a.replace(i,"else{"),a=a.replace(j,"else if("),a=a.replace(m,"function("),a=a.replace(n,"arguments[$2]"),a=a.replace(o,"return ("),a=a.replace(p,".");for(var c=0;c<q.length;c++){var d=new RegExp(b+"."+q[c].prefix+".","g");a=a.replace(d,q[c].prefix+".")}for(var c=0;c<MATHS.length;c++){var e=b+"."+MATHS[c]+"\\(";a=a.replace(new RegExp(e,"g"),"Math."+MATHS[c]+"(")}for(var c=0;c<MATH_PROPS.length;c++)a=a.replace(new RegExp(b+"."+MATH_PROPS[c],"g"),"Math."+MATH_PROPS[c]);return a}a=a.replace(/\s/g,""),a=a.replace(/\b/g,""),a=a.replace(/(\))([A-Za-z0-9_\}])/g,");$2"),a=a.replace(/(for\()([A-Za-z_\-\.\(\)]+)(\,)([A-Za-z0-9_\-\.\(\)]+)(\,)([A-Za-z0-9_\-\.\(\)\*\+\/]+)(\))/g,"for($2=$4;$2<$6;$2++)");var b=this.getInnerExpression(a.slice(a.indexOf("frame("))),c=this.getInnerExpression(a.slice(a.indexOf("beat("))),d=this.getInnerExpression(a.slice(a.indexOf("dsp("))),e=a.replace("frame(){"+b+"}","");e=e.replace("beat(){"+c+"}",""),e=e.replace("dsp(){"+d+"}",""),/c3d\(\)/.test(e)?this.c3d():this.c2d();var f=new RegExp(this.name+".for\\(","g"),g=new RegExp(this.name+".while\\(","g"),h=new RegExp(this.name+".if\\(","g"),i=new RegExp(this.name+".else\\{","g"),j=new RegExp(this.name+".elseIf\\(","g"),k=new RegExp("("+this.name+").([0-9.]+)","g"),l=/([A-Za-z0-9_]+)([\.\!\~\|\%\&\:\(\)\{\}\;\=\+\-\<\>\*\/\[\]\,\^])/g,m=new RegExp(this.name+".func\\(","g"),n=/(\$)([0-9]+)/g,o=new RegExp(this.name+".return\\(","g"),p=new RegExp("\\."+this.name+"\\.","g"),q=this.pluginInstances;return e=r(e,this.name),e=this.modFunction(e),b=r(b,this.name),b=this.modFunction(b),c=r(c,this.name),c=this.modFunction(c),d=r(d,this.name),d=this.modFunction(d),this.drawMethod=b,this.beatMethod=c,this.dspMethod=d,this.drawFunc=""!=this.drawMethod?evalInContext("return (function(){"+this.drawMethod+"});",this):null,this.beatFunc=""!=this.beatMethod?evalInContext("return (function(){"+this.beatMethod+"});",this):null,this.dspFunc=""!=this.dspMethod?evalInContext("return (function(){"+this.dspMethod+"});",this):null,this.setupMethod=e,!0},Centi.prototype.start=function(){for(var a=0;a<this.pluginInstances.length;a++)this.pluginInstances[a].preSetup();0==this.b3d&&(this.ctx=this.canvas.getContext("2d"),this.clear()),this.reset(),this.bg(0),this.bpm(120,4),evalInContext(this.setupMethod,this);for(var a=0;a<this.pluginInstances.length;a++)this.pluginInstances[a].postSetup()},Centi.prototype.modFunction=function(a){var b=(a.match(/function/g)||[]).length;if(b>0){var c=a,d=0;d=c.indexOf("function",d)+7;for(var e=0,f=e;d<c.length;){var g=c.charAt(d);if("{"==g&&e++,"}"==g&&e--,1==f&&0==e)if(c=c.slice(0,d+1)+";"+c.slice(d+1),b--,b>0)d=c.indexOf("function",d)+7;else if(0==b)break;f=e,d++}a=c}return a},Centi.prototype.getInnerExpression=function(a){var b=a,c=0,d=0;if(c=d=b.indexOf("{",d),-1==c)return"";for(var e=0,f=e;d<b.length;){var g=b.charAt(d);if("{"==g&&e++,"}"==g&&e--,1==f&&0==e){b=b.slice(c+1,d);break}f=e,d++}return 0==e?b:""},Centi.prototype.update=function(){for(var a=0;a<this.pluginInstances.length;a++)this.pluginInstances[a].preUpdate();if(0==this.dsp.enable)this.time=this.now()-this.initSec,this.updateBeat();else{this.dsp.analyser.getByteFrequencyData(this.fft),this.dsp.analyser.getByteTimeDomainData(this.waveUint);for(var a=0;a<this.waveUint.length;a++)this.wave[a]=2*(this.waveUint[a]/255-.5)}this.drawFunc&&this.drawFunc();for(var a=0;a<this.pluginInstances.length;a++)this.pluginInstances[a].postUpdate();this.c++,null!=this.toGifFunc&&this.toGifFunc(this.ctx)},Centi.prototype.updateBeat=function(){this.time-this.tempo.preSec>=this.tempo.sec&&(this.beatFunc&&this.beatFunc(),this.tempo.preSec=this.time,this.beat++)},Centi.prototype.reset=function(){this.c=0,this.initSec=this.now(),this.time=0,this.bFill=!0,this.lw(1),this.lj(0),this.lc(0),this.bm(0)},Centi.prototype.c2d=function(){this.b3d=!1},Centi.prototype.c3d=function(){this.b3d=!0},Centi.prototype.bg=function(){if(null!=this.ctx){var a=arguments.length;1==a?(this.bgcolor.r=parseInt(arguments[0]),this.bgcolor.g=parseInt(arguments[0]),this.bgcolor.b=parseInt(arguments[0])):3==a&&(this.bgcolor.r=parseInt(arguments[0]),this.bgcolor.g=parseInt(arguments[1]),this.bgcolor.b=parseInt(arguments[2])),this.clear()}},Centi.prototype.lg=function(){console.log(arguments)},Centi.prototype.log=function(){console.log(arguments)},Centi.prototype.sz=function(a,b){this.size(a,b)},Centi.prototype.size=function(a,b){this.w=parseInt(a),this.h=parseInt(b),this.canvas.width=this.w,this.canvas.height=this.h,this.cx=this.w/2,this.cy=this.h/2},Centi.prototype.clr=function(){this.clear()},Centi.prototype.clear=function(){if(null!=this.ctx){var a=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="rgb("+this.bgcolor.r+","+this.bgcolor.g+","+this.bgcolor.b+")",this.ctx.fillRect(0,0,this.w,this.h),this.ctx.globalCompositeOperation=a}},Centi.prototype.Obj=function(){return new Object},Centi.prototype.obj=function(){return new Object},Centi.prototype.rnd=function(){var a=arguments.length;return 1==a?Math.random()*arguments[0]:2==a?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()},Centi.prototype.rand=function(){var a=arguments.length;return 1==a?Math.random()*arguments[0]:2==a?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()},Centi.prototype.nz=function(){var a=arguments.length;return 1==a?perlin.perlin2(arguments[0],0):2==a?perlin.perlin2(arguments[0],arguments[1]):3==a?perlin.perlin3(arguments[0],arguments[1],arguments[2]):0},Centi.prototype.noise=function(){var a=arguments.length;return 1==a?perlin.perlin2(arguments[0],0):2==a?perlin.perlin2(arguments[0],arguments[1]):3==a?perlin.perlin3(arguments[0],arguments[1],arguments[2]):0},Centi.prototype.rect=function(a,b,c,d){null!=this.ctx&&(this.bFill?this.ctx.fillRect(a,b,c,d):this.ctx.strokeRect(a,b,c,d))},Centi.prototype.oval=function(a,b,c){null!=this.ctx&&(this.ctx.beginPath(),this.ctx.arc(a,b,c,0,2*Math.PI,!0),this.bFill?this.ctx.fill():this.ctx.stroke())},Centi.prototype.ln=function(a,b,c,d){this.line(a,b,c,d)},Centi.prototype.line=function(a,b,c,d){null!=this.ctx&&(this.ctx.beginPath(),this.ctx.moveTo(a,b),this.ctx.lineTo(c,d),this.ctx.stroke())},Centi.prototype.curve=function(){null!=this.ctx&&(8==arguments.length?(this.beginShape(),this.moveTo(arguments[0],arguments[1]),this.curveTo(arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]),this.endShape()):1==arguments.length&&arguments[0].length&&8==arguments[0].length&&this.curve(arguments[0][0],arguments[0][1],arguments[0][2],arguments[0][3],arguments[0][4],arguments[0][5],arguments[0][6],arguments[0][7]))},Centi.prototype.moveTo=function(a,b){null!=this.ctx&&this.ctx.moveTo(a,b)},Centi.prototype.lineTo=function(a,b){null!=this.ctx&&this.ctx.lineTo(a,b)},Centi.prototype.curveTo=function(){null!=this.ctx&&(6==arguments.length?this.ctx.bezierCurveTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):1==arguments.length&&arguments[0].length&&6==arguments[0].length&&this.ctx.bezierCurveTo(arguments[0][0],arguments[0][1],arguments[0][2],arguments[0][3],arguments[0][4],arguments[0][5]))},Centi.prototype.beginShape=function(){null!=this.ctx&&this.ctx.beginPath()},Centi.prototype.endShape=function(){null!=this.ctx&&(this.bFill?this.ctx.fill():this.ctx.stroke())},Centi.prototype.drawMe=function(){if(null!=this.ctx){var a=arguments.length;2==a?this.ctx.drawImage(this.canvas,arguments[0],arguments[1]):4==a?this.ctx.drawImage(this.canvas,arguments[0],arguments[1],arguments[2],arguments[3]):8==a&&this.ctx.drawImage(this.canvas,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])}},Centi.prototype.lw=function(a){this.lineWidth(a)},Centi.prototype.lineWidth=function(a){null!=this.ctx&&(this.ctx.lineWidth=a)},Centi.prototype.lj=function(a){this.lineJoin(a)},Centi.prototype.lineJoin=function(a){null!=this.ctx&&(0==a?this.ctx.lineJoin="bevel":1==a?this.ctx.lineJoin="round":2==a&&(this.ctx.lineJoin="miter"))},Centi.prototype.lc=function(a){this.lineCap(a)},Centi.prototype.lineCap=function(a){null!=this.ctx&&(0==a?this.ctx.lineCap="butt":1==a?this.ctx.lineCap="round":2==a&&(this.ctx.lineCap="square"))},Centi.prototype.bm=function(a){this.blendMode(a)},Centi.prototype.blendMode=function(a){if(null!=this.ctx){var b="source-over",c=["source-over","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"];a<c.length&&(b=c[a],this.ctx.globalCompositeOperation=b)}},Centi.prototype.col=function(){var a=arguments.length,b="rgb(0,0,0)";1==a?b="rgb("+parseInt(arguments[0])+","+parseInt(arguments[0])+","+parseInt(arguments[0])+")":2==a?b="rgba("+parseInt(arguments[0])+","+parseInt(arguments[0])+","+parseInt(arguments[0])+","+parseInt(arguments[1])/255+")":3==a?b="rgb("+parseInt(arguments[0])+","+parseInt(arguments[1])+","+parseInt(arguments[2])+")":4==a&&(b="rgba("+parseInt(arguments[0])+","+parseInt(arguments[1])+","+parseInt(arguments[2])+","+parseInt(arguments[3])/255+")"),this.ctx.fillStyle=b,this.ctx.strokeStyle=b},Centi.prototype.fill=function(){this.bFill=!0},Centi.prototype.strk=function(){this.stroke()},Centi.prototype.stroke=function(){this.bFill=!1},Centi.prototype.push=function(){null!=this.ctx&&this.ctx.save()},Centi.prototype.pop=function(){null!=this.ctx&&this.ctx.restore()},Centi.prototype.rotate=function(a){null!=this.ctx&&this.ctx.rotate(a)},Centi.prototype.scale=function(a,b){null!=this.ctx&&this.ctx.scale(a,b)},Centi.prototype.translate=function(a,b){null!=this.ctx&&this.ctx.translate(a,b)},Centi.prototype.transform=function(a,b,c,d,e,f){null!=this.ctx&&this.ctx.transform(a,b,c,d,e,f)},Centi.prototype.drawFFT=function(a,b,c,d,e,f){for(var g=f||2,h=e||9,i=this.fft.length,j=c/i,k=d/255,l=0;i>l;l+=h)this.rect(a+l*j,b+d,g,-this.fft[l]*k)},Centi.prototype.drawWave=function(a,b,c,d,e){var f=e||9,g=this.wave.length,h=c/(g-1),i=d/2;this.beginShape();for(var j=0;g>j;j+=f)this.lineTo(a+j*h,b+i+this.wave[j]*i);this.endShape()},Centi.prototype.interp=function(a,b,c){return b+(a-b)*c},Centi.prototype.dist=function(){var a=arguments.length;if(4==a){var b=arguments[0]-arguments[2],c=arguments[1]-arguments[3];return Math.sqrt(b*b+c*c)}return 2==a&&arguments[0].hasOwnProperty("x")&&arguments[0].hasOwnProperty("y")&&arguments[1].hasOwnProperty("x")&&arguments[1].hasOwnProperty("y")?this.dist(arguments[0].x,arguments[0].y,arguments[1].x,arguments[1].y):void 0},Centi.prototype.wrap=function(a,b,c){var d=c-b;return d>0?(b>a&&(a+=d),a>c&&(a-=d),a):a},Centi.prototype.minmax=function(a,b,c){return this.minMax(a,b,c)},Centi.prototype.minMax=function(a,b,c){return Math.min(c,Math.max(a,b))},Centi.prototype.map=function(a,b,c,d,e){return(a-b)/(c-b)*(e-d)+d},Centi.prototype.zmap=function(a,b,c,d,e){return this.minMax(this.map(a,b,c,d,e),d,e)},Centi.prototype.avg=function(a){if(a&&a.length>0){for(var b=a.length,c=0,d=0;b>d;d++)c+=a[d];return c/b}return 0},Centi.prototype.cent=function(){var a=arguments.length;if(1==a&&arguments[0].length>1){a=arguments[0].length;for(var b={x:0,y:0},c=0,d=0;a>d;d++){var e=arguments[0][d],f=arguments[0][(d+1)%a];b.x+=(e.x+f.x)*(e.x*f.y-f.x*e.y),b.y+=(e.y+f.y)*(e.x*f.y-f.x*e.y),c+=e.x*f.y-f.x*e.y}return c/=2,b.x=b.x/(6*c),b.y=b.y/(6*c),b}return{x:0,y:0}},Centi.prototype.curves=function(){var a=arguments.length;if(9==a)return this.getPointsOnCurve(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);if(2==a){if(arguments[1].length&&8==arguments[1].length)return this.getPointsOnCurve(arguments[0],arguments[1][0],arguments[1][1],arguments[1][2],arguments[1][3],arguments[1][4],arguments[1][5],arguments[1][6],arguments[1][7])}else if(1==a&&arguments[0].length&&9==arguments[0].length)return this.getPointsOnCurve(arguments[0][0],arguments[0][1],arguments[0][2],arguments[0][3],arguments[0][4],arguments[0][5],arguments[0][6],arguments[0][7],arguments[0][8])},Centi.prototype.getPointsOnCurve=function(a,b,c,d,e,f,g,h,i){2>a&&(a=2);for(var j=[],k=0;a>k;k++){var l=k/(a-1);j.push(this.getPointOnCubicBezier(l,b,d,f,h)),j.push(this.getPointOnCubicBezier(l,c,e,g,i))}return j},Centi.prototype.getPointOnCubicBezier=function(a,b,c,d,e){var f=1-a;return f*f*f*b+3*f*f*a*c+3*f*a*a*d+a*a*a*e},Centi.prototype.radToDeg=function(a){return this.r2d(a)},Centi.prototype.r2d=function(a){return 180*a/Math.PI},Centi.prototype.degToRad=function(a){return this.d2r(a)},Centi.prototype.d2r=function(a){return a*Math.PI/180},Centi.prototype.tree=function(a){function b(a,b){return Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)}this.kdtree=new kdTree(a,b,["x","y"])},Centi.prototype.nears=function(a,b,c){return this.kdtree.nearest(a,b,c)},Centi.prototype.bpm=function(a,b){this.tempo.bpm=a?a:120,this.tempo.divide=b?b:4,this.tempo.sec=4*(60/this.tempo.bpm)/this.tempo.divide,this.tempo.preSec=this.time},Centi.prototype.noteToFreq=function(a){return this.n2f(a)},Centi.prototype.n2f=function(a){return 440*Math.pow(2,(a-69)/12)},Centi.prototype.sortNum=function(a){a.sort(function(a,b){return b>a?-1:a>b?1:0})},Centi.prototype.reverse=function(a){a.reverse()},Centi.prototype.fold=function(a){if(a.reduce)return a.reduce(function(a,b){return a+b});for(var b=0,c=0;c<a.length;c++)b+=a[c];return b},Centi.prototype.Vec2=function(a,b){return new Centi.Vec2(a,b)},Centi.prototype.vec2=function(a,b){return new Centi.Vec2(a,b)},Centi.Vec2=function(a,b){this.x=a,this.y=b},Centi.prototype.now=function(){return(new Date).getTime()/1e3},Centi.prototype.new=function(a,b){function c(){a.apply(this,b)}return c.prototype=a.prototype,new c};var CT_FUNCS=Object.getOwnPropertyNames(Centi.prototype);window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,window.XMLHttpRequest||(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}throw new Error("This browser does not support XMLHttpRequest.")});var audioContext=null,audioContextClass=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,audioAnalyser=null;Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0;c<this.length;c++)a.call(b||null,this[c],c,this)});